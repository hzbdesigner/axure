<!DOCTYPE html>
<!-- saved from url=(0074)http://life.qq.com/weixin/r/festival/receive/1/3/0?ticket=GfZCKEMBAACo5bNS -->
<html lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="res/wei_dialog.css">
<title>新春大吉</title>

<!--
 !!! 部署时请正确配置manifest 缓存js/gif/mp3等
-->

<script src="res/wei_webapp_v2_common.js">
</script>
<style>abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,fieldset,figure,figcaption,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,small,time,video,legend{display:block;}</style>
<!--<script src="http://imgcache.life.qq.com/www/misc/scripts/MAudio.js"></script>-->
<style>

body,article,section,h1,h2,h3,hgroup,p,a,ul,ol,li,em,div,small,span,footer,canvas,figure,figcaption,input{margin:0;padding:0;}
body *{
	-webkit-transform-style: preserve-3d;
	-webkit-backface-visibility: hidden;
}
img{border:none;}
input:focus{outline:0 none;
	-webkit-user-modify:read-write-plaintext-only;-webkit-tap-highlight-color:rgba(0,0,0,0);}
input[type=search]{-webkit-appearance:none;}
*[hidden]{display:none !important;}
a{text-decoration:none;cursor:pointer;}
ul{list-style-type:none;}
small,small em{font-size:15px;}
figure[hidden]{display:none;}
.box:after{ clear: both; display: block; visibility: hidden; height: 0; content: "."; }
.box{ *zoom: 1; }

body{overflow:hidden;background:#000;}
body *{
	-webkit-transform-style: preserve-3d;
	-webkit-backface-visibility: hidden;
}
a:first-of-type{display:block;background-position:50% 0;background-repeat:no-repeat;text-align:center;}
a:first-of-type>img{display:block;margin:0 auto;max-width:320px;}
p{display:block;position:absolute;text-align:center;opacity:.9;
	padding-top:10px;font-size:10px;line-height:16px;text-shadow:0 0 5px #fff;
	-webkit-transform-origin:0 0;
}
p>img, p>span{position:absolute;}
p>img{
	/*width:60px;height:60px;display:inline-block;top:32px;left:40px;
	-webkit-transform-origin:0 0;-webkit-transform:rotate(-14deg);*/
	width:54px;height:54px;display:inline-block;top:15px;left:108px;
}
p>h1{
	font-size:18px;line-height:24px;font-weight:bold;margin-top:65px;text-indent:10px;
}
/*
p>span{top:20px;left:125px;}
p>span>h1{	font-size:18px;line-height:24px;font-weight:bold;}
p>span>h2{font-size:14px;line-height:20px;font-weight:normal;}
p>span>h3{color:red;font-size:22px;line-height:30px;font-weight:normal;}
#toggleSnd{position:absolute;bottom:0;right:0;z-index:9;
	display:inline-block;color:#ccc;text-decoration:underline;
	font-size:14px;line-height:30px;min-width:100px;text-align:right;padding-right:10px;
}
*/
footer{position:absolute;left:10px;bottom:7px;}

</style>
</head>
<body style="height: 524px;">

<!--跳转地址-->
<a href="javascript:goToChoose();" style="height: 524px; background-image: url(res/2.jpg); -webkit-background-size: 320px 503px;"></a>
<footer></footer>
<a href="javascript:void(0)" id="toggleSnd" rel="res/snd.mp3" hidden=""></a>

<script>
var ticket = 'GfZCKEMBAACo5bNS'; 
var tplId = '2'; 
var wxuin = '350613835'; 
var appId = 'wx2ab90e75a21662b0';
var imgUrl = 'res/abm_s.png';
var title = '圣诞快乐！';
var content = 'jackliu请了神秘嘉宾祝你圣诞快乐！！';
var sendFriendLink = '';
var timeLineLink = '';


var sendAppMessageFun = function(argv){
	sendFriendLink = 'http://life.qq.com/weixin/r/festival/receive/' + wxuin + '/' + (new Date().getTime()) + '/' + tplId;
    var linkKey = '10';
    if(argv == 'isButton'){
        linkKey = '7';
    }
    _doAjax('/weixin/festival/statics','get',{linkKey:linkKey, tplId:tplId, wxuin:wxuin},function(sendData){
                              if(sendData.code == 0){
                              //成功
                              }
                            });
    WeixinJSBridge.invoke('sendAppMessage',{
                          "appid":appId,
                          "img_url":imgUrl,
                          "img_width":"640",
                          "img_height":"640",
                          "link":sendFriendLink,
                          "desc":content,
                          "title":title
                          }, function(res) {
                          if(res.err_msg != 'send_app_msg:cancel' && argv == 'isButton'){
                          //      location.href = '/weixin/festival/sendOk?tplId=' + tplId + '&ticket=' + ticket;
                                }
                            _report('send_msg', res.err_msg);
                          })
};

var sendTimelineFun = function(argv){
	timeLineLink = 'http://life.qq.com/weixin/r/festival/receive/' + wxuin + '/' + (new Date().getTime()) + '/' + tplId ;
    var linkKey = '8';
    if(argv == 'isButton'){
        linkKey = '9';
    }
    _doAjax('/weixin/festival/statics','get',{linkKey:linkKey, tplId:tplId, wxuin:wxuin},function(sendData){
                                    if(sendData.code == 0){
                                        //成功
                                    }
                                });

	WeixinJSBridge.invoke('shareTimeline',{
                          "img_url":imgUrl,
                          "img_width":"640",
                          "img_height":"640",
                          "link":timeLineLink,
                          "desc":content,
                          "title":content
                          }, function(res) {
                            _report('timeline', res.err_msg);
                          });
};

//微信分享
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {

    // 发送给好友
    WeixinJSBridge.on('menu:share:appmessage', sendAppMessageFun);

    // 分享到朋友圈
    WeixinJSBridge.on('menu:share:timeline', sendTimelineFun);

    // 分享到微博
    WeixinJSBridge.on('menu:share:weibo', function(argv){
        WeixinJSBridge.invoke('shareWeibo',{
                              "content":content,
                              "url":'http://life.qq.com/weixin',
                              }, function(res) {
                                _report('weibo', res.err_msg);
                              });
    });

}, false);

</script><script>
var srcWxuin="1";
var linkKey="3";
var wxuin="350613835";
var cqrcode="";
var haveCoupon = ""; 

function goToSend(){
   // MLoading.show('加载中...');
    clearTimeout(window._autojumpTo);
    window.location.href="youhui.htm"
}
function goToChoose(){
    MLoading.show('加载中...');
    clearTimeout(window._autojumpTo);
    window.location.href="youhui.htm"
}
function send(){
        MLoading.show('加载中...');
        clearTimeout(window._autojumpTo);
        window.location.href="youhui.htm";
}

_onPageLoaded(function(){
	var pw = window.innerWidth;
	var ph = window.innerHeight;
	_q('body').style.height = ph + 'px';
	MLoading.show('加载中...');
	var main = _q('a'),
		lk = main.getAttribute('href'),
		cont = main.innerHTML,

		assets = [
			null,//'http://imgcache.life.qq.com/www/misc/images/st_201311_xmas/obama/1.jpg',
			'res/2.jpg',
			'res/3.jpg',
			'http://imgcache.life.qq.com/www/misc/images/st_201311_xmas/obama/pop.png',
			'http://imgcache.life.qq.com/www/misc/images/st_201311_xmas/copy2.png'
		],

		loadFlag = assets.length - 1,
		animateCfg = [
			{asset:1, duration:300},
			{asset:2, duration:300}
		],
		imgs = [],
		checkAssets = function(e){
			if (!--loadFlag)
				init();
		},
		mainW = 320,
		scaleF = 1,
		bkSize = function(dom, img){
			var w = mainW;
			var h = img.height * (w / img.width);
			if (h > ph){
				scaleF = ph/h;
				w = scaleF * w;
				h = ph;
				mainW = w;
			}
			dom.style[_vendor + 'BackgroundSize'] = parseInt(w)+'px '+parseInt(h)+'px';
		},
		init = function(){
			MLoading.hide();
			main.style.height = ph + 'px';
		//	bkSize(main, imgs[0]);
		//	main.style.backgroundImage = 'url('+ assets[0] +')';
			_show(main);
			//copyright();
			
		//	main.onclick = function(){
				window._autojumpTo = null;
				gotoView2();
		//	};
		},
		gotoView2 = function(e){
			main.style.backgroundImage = 'none';
			main.onclick = null;
			setTimeout(function(){
				main.setAttribute('href', lk);
			}, 1000);
			
			playAnima();
			//showPop();
			playMusic();
			
			if (window._autojumpTo === null){
				enableAutoJump();
			}
		},
		enableAutoJump = function(){
			window._autojumpTo = setTimeout(function(){
				location.href = lk;
			}, 7800);
			console.log('enable AutoJump');
		},
		playAnima = function(){
			var _to = null,
				_next = 0,
				_setFrame = function(){
					var idx = animateCfg[_next].asset;
					var time = animateCfg[_next].duration;
					main.style.backgroundImage = 'url('+ assets[ idx] +')';
					bkSize(main, imgs[idx]);
					
					_next = _next+1 >= animateCfg.length ? 0 : _next+1;
					setTimeout(_setFrame, time);
				};
			_setFrame();
			return _to;
		},
		showPop = function(){
			var w = parseInt(.5*imgs[3].width);
			var h = parseInt(.5*imgs[3].height);
			var pop = document.createElement('p');
			pop.style.top = 0;
			pop.style.right = parseInt(.5*(pw-mainW)) + 'px';
			pop.style.width = w+'px';
			pop.style.height = (h-10)+'px';
			pop.style[_vendor + 'BackgroundSize'] = w+'px '+h+'px';
			pop.style.backgroundImage = 'url('+ assets[3] +')';
			pop.innerHTML = cont;
			if (_env.android && _env.version<2.4){
				//TODO
			}else{
				if (scaleF != 1) pop.style[_vendor + 'Transform'] = 'scale('+scaleF+')';
			}
			document.body.appendChild(pop);
		},
		musicInited = false,
		playMusic = function(){
		/*	if (musicInited) return;
			musicInited = true;
			var tglSnd = _q('#toggleSnd');
			var snd = null;
			var tglText = function(){
				tglSnd.innerHTML = snd.playing ? '关闭音乐' : '开启音乐';
			};
			var clickTglSnd = function(e){
				e.stopPropagation();
				if (snd.playing){
					snd.pause();
				}else{
					snd.resume();
				}
				tglText();
			};
			snd = new MAudio([tglSnd.getAttribute('rel')], true);
			snd.registCallback('canplay', function(){
				console.log('music canplay');
				tglSnd.addEventListener('touchend', clickTglSnd);
				tglText(null);
				_show(tglSnd);
			});
			snd.registCallback('ended', function(){
				console.log('music loop');
				snd.replay();
			});*/
		},
		copyright = function(){
			var ft = _q('footer'),
				fw = parseInt(imgs[4].width * .5 * scaleF),
				fh = parseInt(imgs[4].height * .5 * scaleF);
			ft.style.width = fw+'px';
			ft.style.height = fh+'px';
			ft.style.background = 'url('+ assets[4] +') no-repeat 0 0';
			ft.style.backgroundSize = fw+'px '+fh+'px';
		};
	main.removeAttribute('href');
	main.innerHTML = '';
	_forEach(assets, function(path, idx){
		var img = new Image;
		img.id = 'img'+idx;
		if (path !== null){
            img.addEventListener('load', checkAssets);
		    img.src = path;
        }
		imgs[idx] = img;
	});
	_pageToTop();
});

</script>

</body></html>